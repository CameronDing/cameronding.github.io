<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>下载你爷爷的文件须知</title>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#005DF0',
                        primaryHover: '#003DF0',
                        secondary: '#3b82f6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
            }
            .btn-hover {
                @apply transition-all duration-300 hover:shadow-lg hover:-translate-y-0.5;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex flex-col items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-xl shadow-xl p-8 max-w-3xl w-full max-h-[90vh] overflow-y-auto">
        <!-- 标题区域 -->
        <h1 id="title" class="text-3xl font-bold text-center text-gray-800 mb-6"></h1>
        
        <!-- 内容区域 -->
        <div id="content" class="text-xl text-gray-800 leading-relaxed mb-8 whitespace-pre-line"></div>
        
        <!-- 按钮区域 -->
        <div class="flex justify-center gap-4">
            <button id="downloadBtn" class="bg-primary hover:bg-primaryHover text-white font-bold py-3 px-8 rounded-full btn-hover flex items-center">
                <i class="fa fa-download mr-2"></i> 下载
            </button>
            <button id="exitBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-8 rounded-full btn-hover flex items-center">
                <i class="fa fa-times mr-2"></i> 退出
            </button>
        </div>
    </div>

    <script>
        // 获取URL参数
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            const regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            const results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // 验证参数
        const nameParam = getUrlParameter('name');
        const textParam = getUrlParameter('text');
        const targetParam = getUrlParameter('target');

        // 检查参数是否有效
        if (!nameParam || !textParam || !targetParam) {
            alert('请从djm.pages.dev中正确的渠道下载。');
            window.close();
        }

        // 设置标题
        const titleElement = document.getElementById('title');
        titleElement.textContent = `下载${nameParam}须知 - djm.pages.dev`;

        // 加载文本内容
        const contentElement = document.getElementById('content');
        fetch(textParam)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(text => {
                contentElement.textContent = text;
            })
            .catch(error => {
                console.error('Error loading text file:', error);
                alert('请从djm.pages.dev中正确的渠道下载。');
                window.close();
            });

        // 下载按钮功能
        const downloadBtn = document.getElementById('downloadBtn');
        downloadBtn.addEventListener('click', () => {
            // 创建一个隐藏的下载链接
            const downloadLink = document.createElement('a');
            downloadLink.href = targetParam;
            downloadLink.download = targetParam.split('/').pop() || 'download';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        });

        // 退出按钮功能
        const exitBtn = document.getElementById('exitBtn');
        exitBtn.addEventListener('click', () => {
            window.close();
        });

        // 页面加载完成后检查所有资源是否有效
        window.addEventListener('load', () => {
            // 验证target文件是否存在
            fetch(targetParam, { method: 'HEAD' })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Target file not found');
                    }
                })
                .catch(error => {
                    console.error('Error checking target file:', error);
                    alert('请从djm.pages.dev中正确的渠道下载。');
                    window.close();
                });
        });
    </script>
</body>
</html>
