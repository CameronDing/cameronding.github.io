<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>丁佳铭网页内置音频播放器</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <style>
    /* 基础样式重置 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      background-color: #F9FAFB;
      color: #1F2937;
    }
    body.dark {
      background-color: #111827;
      color: #F3F4F6;
    }
    
    /* 退出按钮 */
    .exit-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      padding: 6px 12px;
      background-color: rgba(255, 255, 255, 0.8);
      color: #374151;
      border-radius: 4px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      z-index: 100;
      text-decoration: none;
    }
    .exit-btn:hover {
      background-color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    body.dark .exit-btn {
      background-color: rgba(30, 41, 59, 0.8);
      color: #E5E7EB;
    }
    body.dark .exit-btn:hover {
      background-color: #374151;
    }
    
    /* 标题区域 */
    .title-container {
      position: absolute;
      top: 20%;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      text-align: center;
      padding: 0 20px;
    }
    .audio-title {
      font-size: 4rem; /* 5xl 对应4rem */
      font-weight: 500;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* 进度条区域 */
    .progress-container {
      position: absolute;
      bottom: 35%;
      left: 50%;
      transform: translateX(-50%);
      width: 90%;
      max-width: 1200px;
    }
    .time-display {
      display: flex;
      justify-content: space-between;
      font-size: 1rem;
      color: #6B7280;
      margin-bottom: 8px;
    }
    body.dark .time-display {
      color: #9CA3AF;
    }
    
    /* 进度条样式 */
    .progress-slider {
      -webkit-appearance: none;
      width: 100%;
      height: 3px;
      border-radius: 2px;
      background: #E2E8F0;
      outline: none;
    }
    body.dark .progress-slider {
      background: #374151;
    }
    /* 进度条已播放部分 */
    .progress-slider::-webkit-slider-runnable-track {
      -webkit-appearance: none;
      height: 3px;
      border-radius: 2px;
      background: linear-gradient(to right, #3B82F6 var(--progress, 0%), #E2E8F0 var(--progress, 0%));
    }
    body.dark .progress-slider::-webkit-slider-runnable-track {
      background: linear-gradient(to right, #3B82F6 var(--progress, 0%), #374151 var(--progress, 0%));
    }
    /* 进度条滑块 */
    .progress-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: #3B82F6;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: -5.5px; /* 居中对齐轨道 */
    }
    .progress-slider::-webkit-slider-thumb:hover {
      transform: scale(1.05);
      background: #2563EB;
    }
    
    /* 播放按钮 */
    .play-btn-container {
      position: absolute;
      bottom: 10%;
      left: 50%;
      transform: translateX(-50%);
    }
    .play-btn {
      width: 112px; /* w-28 = 112px */
      height: 112px;
      border-radius: 50%;
      background-color: #3B82F6;
      color: white;
      border: none;
      outline: none;
      cursor: pointer;
      transition: all 0.25s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    .play-btn:hover {
      background-color: #2563EB;
    }
    .play-btn:active {
      transform: scale(0.94);
    }
    .play-icon {
      font-size: 2.5rem; /* text-5xl = 2.5rem */
      margin-left: 6px; /* ml-1.5 = 6px */
    }
    
    /* 移动端适配（≤768px） */
    @media (max-width: 768px) {
      .audio-title {
        font-size: 1.5rem; /* text-2xl */
      }
      .title-container {
        top: 25%;
      }
      .progress-container {
        bottom: 40%;
      }
      .play-btn-container {
        bottom: 15%;
      }
      .play-btn {
        width: 72px; /* w-18 = 72px */
        height: 72px;
      }
      .play-icon {
        font-size: 1.5rem; /* text-3xl */
        margin-left: 4px;
      }
    }
  </style>
</head>

<body>
  <!-- 退出按钮 -->
  <a href="https://djm.pages.dev/download-page.html" class="exit-btn">
    <i class="fa fa-sign-out mr-1"></i>退出播放
  </a>
  
  <!-- 标题区域 -->
  <div class="title-container">
    <h1 class="audio-title" id="audioTitle">未指定音频</h1>
  </div>
  
  <!-- 进度条区域 -->
  <div class="progress-container">
    <div class="time-display">
      <span id="currentTime">00:00</span>
      <span id="totalTime">00:00</span>
    </div>
    <input type="range" id="progressBar" class="progress-slider" min="0" max="100" step="0.1" value="0">
  </div>
  
  <!-- 播放按钮 -->
  <div class="play-btn-container">
    <button class="play-btn" id="playPauseBtn">
      <i class="fa fa-play play-icon" id="playPauseIcon"></i>
    </button>
  </div>
  
  <!-- 音频元素 -->
  <audio id="audioPlayer" style="display: none;"></audio>
  
  <script>
    // DOM元素
    const audioPlayer = document.getElementById('audioPlayer');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const playPauseIcon = document.getElementById('playPauseIcon');
    const progressBar = document.getElementById('progressBar');
    const currentTimeEl = document.getElementById('currentTime');
    const totalTimeEl = document.getElementById('totalTime');
    const audioTitle = document.getElementById('audioTitle');
    const body = document.body;
    
    // 状态
    let isPlaying = false;
    let audioLoaded = false;
    let isFullscreen = false;
    
    // 1. 深色模式适配
    function initDarkMode() {
      if (window.matchMedia?.('(prefers-color-scheme: dark)').matches) {
        body.classList.add('dark');
      }
    }
    
    // 2. 电脑端自动全屏
    function enterFullscreen() {
      if (window.innerWidth > 768 && !isFullscreen) {
        const docEl = document.documentElement;
        if (docEl.requestFullscreen) {
          docEl.requestFullscreen();
        } else if (docEl.webkitRequestFullscreen) {
          docEl.webkitRequestFullscreen();
        } else if (docEl.msRequestFullscreen) {
          docEl.msRequestFullscreen();
        }
        isFullscreen = true;
      }
    }
    
    // 监听全屏状态变化
    document.addEventListener('fullscreenchange', () => {
      isFullscreen = !!document.fullscreenElement;
    });
    
    // 3. 解析URL参数
    function parseURLParams() {
      const params = new URLSearchParams(window.location.search);
      const result = {};
      for (const [key, value] of params.entries()) {
        result[key] = decodeURIComponent(value);
      }
      return result;
    }
    
    // 4. 处理参数（设置音频和标题）
    function handleParams(params) {
      // 设置标题
      audioTitle.textContent = params.title || '未指定音频';
      // 设置音频源
      if (params.url) {
        audioPlayer.src = params.url;
        // 音频加载完成后初始化进度条
        audioPlayer.onloadedmetadata = () => {
          audioLoaded = true;
          progressBar.max = audioPlayer.duration; // 进度条max=音频总秒数
          totalTimeEl.textContent = formatTime(audioPlayer.duration);
          // 自动播放（如果参数指定）
          if (params.autoplay === 'true') {
            playAudio();
          }
        };
      }
    }
    
    // 5. 时间格式化（秒→MM:SS）
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    
    // 6. 更新进度条（颜色+位置）
    function updateProgress() {
      if (audioLoaded) {
        // 计算进度百分比
        const progressPercent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        // 设置进度条已播放部分颜色
        progressBar.style.setProperty('--progress', `${progressPercent}%`);
        // 同步进度条位置
        progressBar.value = audioPlayer.currentTime;
        // 更新当前时间显示
        currentTimeEl.textContent = formatTime(audioPlayer.currentTime);
      }
    }
    
    // 7. 播放/暂停控制
    function playAudio() {
      audioPlayer.play().then(() => {
        isPlaying = true;
        playPauseIcon.classList.replace('fa-play', 'fa-pause');
      }).catch(error => {
        alert(`播放失败：${error.message}`);
      });
    }
    
    function pauseAudio() {
      audioPlayer.pause();
      isPlaying = false;
      playPauseIcon.classList.replace('fa-pause', 'fa-play');
    }
    
    // 8. 进度条拖动控制
    function handleProgressDrag() {
      if (audioLoaded) {
        // 拖动时更新播放时间和进度条颜色
        const targetTime = parseFloat(progressBar.value);
        audioPlayer.currentTime = targetTime;
        const progressPercent = (targetTime / audioPlayer.duration) * 100;
        progressBar.style.setProperty('--progress', `${progressPercent}%`);
        currentTimeEl.textContent = formatTime(targetTime);
        // 拖动结束后如果是播放状态，继续播放
        if (isPlaying) {
          audioPlayer.play().catch(err => console.error('拖动后播放失败：', err));
        }
      }
    }
    
    // 9. 音频播放结束处理
    function handleAudioEnded() {
      pauseAudio();
      // 重置进度条
      progressBar.value = 0;
      progressBar.style.setProperty('--progress', '0%');
      audioPlayer.currentTime = 0;
      currentTimeEl.textContent = '00:00';
    }
    
    // 10. 绑定事件
    function bindEvents() {
      // 播放/暂停按钮点击
      playPauseBtn.addEventListener('click', () => {
        isPlaying ? pauseAudio() : playAudio();
      });
      // 进度条拖动（实时更新）
      progressBar.addEventListener('input', handleProgressDrag);
      // 进度条拖动结束
      progressBar.addEventListener('change', handleProgressDrag);
      // 音频播放时间更新（每秒更新进度）
      audioPlayer.addEventListener('timeupdate', updateProgress);
      // 音频播放结束
      audioPlayer.addEventListener('ended', handleAudioEnded);
    }
    
    // 初始化
    window.addEventListener('DOMContentLoaded', () => {
      initDarkMode();
      const params = parseURLParams();
      handleParams(params);
      bindEvents();
      // 电脑端延迟进入全屏（确保DOM加载完成）
      if (window.innerWidth > 768) {
        setTimeout(enterFullscreen, 100);
      }
    });
  </script>
</body>
</html>
